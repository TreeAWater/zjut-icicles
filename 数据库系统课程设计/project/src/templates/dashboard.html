{% extends "base.html" %}

{% block title %}仪表盘 - 教务管理系统{% endblock %}

{% block head_extra %}
<style>
    .dashboard-container {
        padding: 20px;
    }
    .welcome-section {
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .module-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    .module-card {
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        padding: 20px;
        transition: transform 0.2s;
    }
    .module-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .module-card h3 {
        margin-top: 0;
        color: #333;
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
    }
    .module-card ul {
        list-style-type: none;
        padding-left: 0;
    }
    .module-card ul li {
        margin-bottom: 8px;
    }
    .module-card ul li a {
        color: #4CAF50;
        text-decoration: none;
        display: block;
        padding: 5px 0;
    }
    .module-card ul li a:hover {
        color: #45a049;
        text-decoration: underline;
    }
    .stats-section {
        margin-top: 20px;
        padding: 15px;
        background-color: #e9f7ef;
        border-radius: 8px;
    }
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
    }
    .stat-card {
        text-align: center;
        padding: 15px;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .stat-card .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #2e86de;
    }
    .stat-card .stat-label {
        color: #666;
        font-size: 14px;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="welcome-section">
        <h2>欢迎, {{ user.username }}</h2>
        <p>您当前的身份是: {{ user.role }}</p>
    </div>

    {% if user.role == 'student' %}
    <!-- 学生仪表盘 -->
    <div class="module-grid">
        <div class="module-card">
            <h3>选课中心</h3>
            <ul>
                <li><a href="{{ url_for('main.course_selection') }}">课程选择</a></li>
            </ul>
        </div>
        
        <div class="module-card">
            <h3>课表查询</h3>
            <ul>
                <li><a href="{{ url_for('main.timetable') }}">我的课表</a></li>
            </ul>
        </div>
        
        <div class="module-card">
            <h3>成绩查询</h3>
            <ul>
                <li><a href="{{ url_for('main.grade_report') }}">成绩单</a></li>
                <li><a href="{{ url_for('main.gpa_ranking') }}">GPA排名</a></li>
            </ul>
        </div>
        
        <div class="module-card">
            <h3>培养计划</h3>
            <ul>
                <li><a href="{{ url_for('main.curriculum') }}">专业培养计划</a></li>
                <li><a href="{{ url_for('main.graduation_requirements') }}">毕业要求查询</a></li>
            </ul>
        </div>
        
        <div class="module-card">
            <h3>教学评价</h3>
            <ul>
                <li><a href="{{ url_for('main.course_evaluation') }}">课程评价</a></li>
                <li><a href="{{ url_for('main.my_evaluations') }}">我的评价</a></li>
            </ul>
        </div>
    </div>
    
    <div class="stats-section">
        <h3>我的学习概况</h3>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="total-credits">--</div>
                <div class="stat-label">已修学分</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="current-gpa">--</div>
                <div class="stat-label">当前GPA</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="courses-count">--</div>
                <div class="stat-label">本学期课程数</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="major-rank">--</div>
                <div class="stat-label">专业排名</div>
            </div>
        </div>
    </div>
    
    {% elif user.role == 'instructor' %}
    <!-- 教师仪表盘 -->
    <div class="module-grid">
        <div class="module-card">
            <h3>教学管理</h3>
            <ul>
                <li><a href="{{ url_for('main.my_teaching') }}">我的授课</a></li>
                <li><a href="{{ url_for('main.class_roster') }}">班级名单</a></li>
                <li><a href="{{ url_for('main.grade_input') }}">成绩录入</a></li>
                <li><a href="{{ url_for('main.course_schedule') }}">课程安排</a></li>
            </ul>
        </div>
        
        <div class="module-card">
            <h3>成绩分析</h3>
            <ul>
                <li><a href="{{ url_for('main.course_statistics') }}">课程统计</a></li>
                <li><a href="{{ url_for('main.grade_distribution') }}">成绩分布</a></li>
            </ul>
        </div>
        
        <div class="module-card">
            <h3>教学资源</h3>
            <ul>
                <li><a href="{{ url_for('main.course_materials') }}">课程资料</a></li>
            </ul>
        </div>
        
        <div class="module-card">
            <h3>教学评价</h3>
            <ul>
                <li><a href="{{ url_for('main.my_evaluations_instructor') }}">我的评价</a></li>
                <li><a href="{{ url_for('main.evaluation_statistics') }}">评价统计</a></li>
            </ul>
        </div>
        
        <div class="module-card">
            <h3>学生管理</h3>
            <ul>
                <li><a href="{{ url_for('main.student_performance') }}">学生表现</a></li>
                <li><a href="{{ url_for('main.academic_warning') }}">学业预警</a></li>
            </ul>
        </div>
        
        <div class="module-card">
            <h3>工作统计</h3>
            <ul>
                <li><a href="{{ url_for('main.workload_statistics') }}">工作量统计</a></li>
            </ul>
        </div>
    </div>
    
    <div class="stats-section">
        <h3>教学工作概况</h3>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="teaching-courses">--</div>
                <div class="stat-label">本学期授课数</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="total-students">--</div>
                <div class="stat-label">学生总数</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avg-grade">--</div>
                <div class="stat-label">平均成绩</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="workload">--</div>
                <div class="stat-label">工作量</div>
            </div>
        </div>
    </div>
    
    {% elif user.role == 'admin' %}
    <!-- 管理员仪表盘 -->
    <div class="module-grid">
        <div class="module-card">
            <h3>用户管理</h3>
            <ul>
                <li><a href="{{ url_for('main.manage_students') }}">学生管理</a></li>
                <li><a href="{{ url_for('main.manage_instructors') }}">教师管理</a></li>
                <li><a href="{{ url_for('main.manage_admins') }}">管理员管理</a></li>
            </ul>
        </div>
        
        <div class="module-card">
            <h3>教务管理</h3>
            <ul>
                <li><a href="{{ url_for('main.manage_departments') }}">院系管理</a></li>
                <li><a href="{{ url_for('main.manage_majors') }}">专业管理</a></li>
                <li><a href="{{ url_for('main.manage_courses') }}">课程管理</a></li>
                <li><a href="{{ url_for('main.manage_sections') }}">教学班管理</a></li>
            </ul>
        </div>
        
        <div class="module-card">
            <h3>系统管理</h3>
            <ul>
                <li><a href="{{ url_for('main.manage_announcements') }}">公告管理</a></li>
                <li><a href="{{ url_for('main.system_settings') }}">系统设置</a></li>
                <li><a href="{{ url_for('main.audit_logs') }}">审计日志</a></li>
            </ul>
        </div>
        
        <div class="module-card">
            <h3>统计报表</h3>
            <ul>
                <li><a href="{{ url_for('main.enrollment_statistics') }}">选课统计</a></li>
                <li><a href="{{ url_for('main.grade_statistics') }}">成绩统计</a></li>
                <li><a href="{{ url_for('main.student_demographics') }}">学生人口统计</a></li>
            </ul>
        </div>
        
        <div class="module-card">
            <h3>教学资源</h3>
            <ul>
                <li><a href="{{ url_for('main.manage_classrooms') }}">教室管理</a></li>
                <li><a href="{{ url_for('main.manage_buildings') }}">建筑管理</a></li>
                <li><a href="{{ url_for('main.manage_timeslots') }}">时间段管理</a></li>
            </ul>
        </div>
    </div>
    
    <div class="stats-section">
        <h3>系统概况</h3>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="total-students-admin">--</div>
                <div class="stat-label">学生总数</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="total-instructors">--</div>
                <div class="stat-label">教师总数</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="active-courses">--</div>
                <div class="stat-label">本学期课程数</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="system-uptime">--</div>
                <div class="stat-label">系统运行时间</div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts_extra %}
<script>
    // 这里将添加获取统计数据的AJAX请求
    // 例如：获取学生的GPA、已修学分等
    document.addEventListener('DOMContentLoaded', function() {
        // 根据用户角色加载不同的统计数据
        const userRole = "{{ user.role }}";
        
        if (userRole === 'student') {
            // 加载学生统计数据
            fetch('/api/student/stats?id={{ user.id }}')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('total-credits').textContent = data.total_credits || '--';
                    document.getElementById('current-gpa').textContent = data.current_gpa || '--';
                    document.getElementById('courses-count').textContent = data.courses_count || '--';
                    document.getElementById('major-rank').textContent = data.major_rank || '--';
                })
                .catch(error => console.error('获取学生统计数据失败:', error));
        } 
        else if (userRole === 'instructor') {
            // 加载教师统计数据
            fetch('/api/instructor/stats?id={{ user.id }}')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('teaching-courses').textContent = data.teaching_courses || '--';
                    document.getElementById('total-students').textContent = data.total_students || '--';
                    document.getElementById('avg-grade').textContent = data.avg_grade || '--';
                    document.getElementById('workload').textContent = data.workload || '--';
                })
                .catch(error => console.error('获取教师统计数据失败:', error));
        }
        else if (userRole === 'admin') {
            // 加载管理员统计数据
            fetch('/api/admin/stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('total-students-admin').textContent = data.total_students || '--';
                    document.getElementById('total-instructors').textContent = data.total_instructors || '--';
                    document.getElementById('active-courses').textContent = data.active_courses || '--';
                    document.getElementById('system-uptime').textContent = data.system_uptime || '--';
                })
                .catch(error => console.error('获取系统统计数据失败:', error));
        }
    });
</script>
{% endblock %} 